name: Documentation
on: push
jobs:
  call-build:
    # to be changed to branch delivery when final merge is done
    uses: vue-styleguidist/vue-styleguidist/.github/workflows/build.yml@build/gh-actions

  build-docs:
    needs: call-build
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - uses: actions/setup-node@v2

      - name: Pre-compile TOC
        run: pnpm predocs

      - name: Build vuepress docs
        run: pnpm docs:build

      # Build all examples (except for docgen-nuxt which needs to be sent to surge)
      - name: Build examples
        run: cd examples; for D in *; do if [ $D != "docgen-nuxt" ]; then cd ..; pnpm build "${D}" -- --ci; cd examples; fi; done || exit 1

      # Move them to the docs (except for docgen-nuxt which needs to be sent to surge)
      - name: Move examples to docs
        run: for D in *; do if [ $D != "docgen-nuxt" ]; then mv "${D}"/dist ../docs/dist/"${D}"; fi; done || exit 1
  
  deploy: 
    needs: build-docs
    runs-on: ubuntu-latest

    steps:
      - run: echo "Deploying docs to gh-pages..."